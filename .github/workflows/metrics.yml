# Licensed under The Unlicense
# Feel free to reuse, edit and redistribute this workflow as you wish, no credits needed
# See https://github.com/lowlighter/metrics for documentation about how to use metrics action

name: Metrics
on:
  # üåè Think about the planet! No need to update stats too frequently
  schedule: [{cron: "0 16 * * *"}]
  # üí° The following line lets you run workflow manually from the action tab!
  workflow_dispatch:
jobs:
  metrics:
    runs-on: ubuntu-latest
    steps:

      - name: ü¶ë General
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
          filename: general.svg
          token: ${{ METRICS_TOKEN_WITH_SCOPES }}
          base: header
          base_indepth: yes
          config_order: base.header, isocalendar, languages, notable, discussions, topics
          #output_action: gist
          #committer_gist: ${{ secrets.GIST }}
          output_action: pull-request
          plugin_isocalendar: yes
          plugin_languages: yes
          plugin_languages_ignored: html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell, gnuplot, vue, scala, c, c++, python, ejs
          plugin_languages_details: lines, bytes-size, percentage
          plugin_languages_sections: most-used, recently-used
          plugin_languages_indepth: yes
          plugin_languages_limit: 2
          plugin_topics: yes
          plugin_topics_limit: 0
          plugin_topics_mode: icons
          plugin_notable: yes
          plugin_discussions: yes

      - name: Organization
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.organization.svg
            user: github
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: header, repositories

      - name: Large display
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.large.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            config_display: large

      - name: JSON metrics
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.example.json
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            config_output: json

      - name: PNG metrics
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.example.png
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            config_output: png

      - name: Metrics insights
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.insights.html
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            config_output: insights

      - name: Presets
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.presets.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: header, repositories
            config_presets: https://raw.githubusercontent.com/lowlighter/metrics/presets/lunar-red/preset.yaml

      - name: Default metrics
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.base.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: header, activity, community, repositories, metadata
            base_indepth: yes

      - name: Default metrics
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.base.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: header, activity, community, repositories, metadata

      - name: Compact display
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.achievements.compact.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES}}
            base: ""
            plugin_achievements: yes
            plugin_achievements_only: >-
                polyglot, stargazer, sponsor, deployer, member, maintainer, developer, scripter, packager, explorer, infographile, manager
            plugin_achievements_display: compact
            plugin_achievements_threshold: X

      - name: Recent activity
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.activity.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_activity: yes
            plugin_activity_limit: 5
            plugin_activity_days: 0
            #plugin_activity_filter: issue, pr, release, fork, review, ref/create

      - name: Current year calendar
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.calendar.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_calendar: yes

      - name: Full history calendar
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.calendar.full.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_calendar: yes
            plugin_calendar_limit: 0

      - name: Contributors with contributions count
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.contributors.contributions.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            template: repository
            repo: RalphHightower
            plugin_contributors: yes
            plugin_contributors_contributions: yes

      - name: Contributors by categories
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.contributors.categories.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            template: repository
            repo: metrics
            plugin_contributors: yes
            plugin_contributors_sections: categories
            plugin_contributors_categories: |
               {
                   "üß© Plugins / üñºÔ∏è templates":["source/plugins/**", "source/templates/**"],
                   "üìö Documentation":["README.md", "**/README.md", "**/metadata.yml"],
                   "üíª Code (other)":["source/**", "Dockerfile"]
               }

      - name: GitHub Discussions
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.discussions.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_discussions: yes
            plugin_discussions_categories_limit: 8

      - name: Indepth analysis
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.followup.indepth.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_followup: yes
            plugin_followup_indepth: yes

      - name: Gists
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.gists.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_gists: yes

      - name: Recent activity
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.activity.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_activity: yes
            plugin_activity_limit: 5
            plugin_activity_days: 0
            #plugin_activity_filter: issue, pr, release, fork, review, ref/create

      - name: Current year calendar
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.calendar.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_calendar: yes

      - name: Full history calendar
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.calendar.full.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_calendar: yes
            plugin_calendar_limit: 0

      - name: Contributors with contributions count
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.contributors.contributions.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            template: repository
            repo: RalphHightower
            plugin_contributors: yes
            plugin_contributors_contributions: yes

      - name: Contributors by categories
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.contributors.categories.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            template: repository
            repo: metrics
            plugin_contributors: yes
            plugin_contributors_sections: categories
            plugin_contributors_categories: |
                {
                    "üß© Plugins / üñºÔ∏è templates":["source/plugins/**", "source/templates/**"],
                    "üìö Documentation":["README.md", "**/README.md", "**/metadata.yml"],
                    "üíª Code (other)":["source/**", "Dockerfile"]
                }

      #- name: GitHub Discussions
      #  if: ${{ success() || failure() }}
      #  uses: lowlighter/metrics@latest
      #  with:
      #      filename: metrics.plugin.discussions.svg
      #      token: ${{ METRICS_TOKEN_WITH_SCOPES }}
      #      base: ""
      #      plugin_discussions: yes
      #      plugin_discussions_categories_limit: 8

      - name: Mildly interesting facts
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
             filename: metrics.plugin.habits.facts.svg
             token: ${{ METRICS_TOKEN_WITH_SCOPES }}
             base: ""
             plugin_habits: yes
             plugin_habits_facts: yes
             plugin_habits_charts: no
             config_timezone: America/New_York

      - name: Recent activity charts
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.habits.charts.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_habits: yes
            plugin_habits_facts: no
            plugin_habits_charts: yes
            config_timezone: America/New_York

      - name: Repository introduction
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.introduction.repository.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            template: repository
            repo: metrics
            base: header
            plugin_introduction: yes

      - name: Full-year calendar
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.isocalendar.fullyear.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_isocalendar: yes
            plugin_isocalendar_duration: full-year

      - name: Indepth analysis
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.languages.indepth.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_languages: yes
            plugin_languages_ignored: >-
                html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell, gnuplot
            plugin_languages_indepth: yes
            plugin_languages_details: lines, bytes-size
            plugin_languages_limit: 4
            plugin_languages_analysis_timeout: 15

      - name: Licenses with open-source ratio graphs
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.licenses.ratio.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            template: repository
            repo: metrics
            plugin_licenses: yes
            plugin_licenses_setup: bash -c '[[ -f package.json ]] && npm ci || true'
            plugin_licenses_legal: no
            plugin_licenses_ratio: yes

      - name: Compact display in base plugin
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.lines.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: repositories
            plugin_lines: yes
            plugin_lines_delay: 30

      - name: Repositories and diff history
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.lines.history.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_lines: yes
            plugin_lines_delay: 30
            plugin_lines_sections: repositories, history
            plugin_lines_repositories_limit: 2
            plugin_lines_history_limit: 1
            repositories_skipped: |
                @use.patterns
                */*
                +lowlighter/metrics

      - name: Contributions
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.notable.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_notable: yes

      - name: Indepth analysis
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.notable.indepth.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_notable: yes
            plugin_notable_indepth: yes
            plugin_notable_repositories: yes

      - name: Detailed report
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.pagespeed.detailed.svg
            token: NOT_NEEDED
            base: ""
            plugin_pagespeed: yes
            plugin_pagespeed_detailed: yes
            #[Get Started with the PageSpeed Insights API ¬†/¬† Google for Developers](https://developers.google.com/speed/docs/insights/v5/get-started )
            plugin_pagespeed_token: ${{ secrets.PAGESPEED_TOKEN }}
            plugin_pagespeed_url: https://Ralphhightower.github.io/RalphHightower 

      - name: Followers
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.people.followers.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_people: yes
            plugin_people_types: followers

      - name: Pinned repositories
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.repositories.pinned.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_repositories: yes
            plugin_repositories_pinned: 2

      - name: Top answers from stackoverflow
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.stackoverflow.svg
            token: NOT_NEEDED
            base: ""
            plugin_stackoverflow: yes
            plugin_stackoverflow_user: 19978043/ralph-hightower
            plugin_stackoverflow_sections: answers-top
            plugin_stackoverflow_limit: 2

      #[Use API Keys with Geocoding API ¬†/¬† Google for Developers](https://developers.google.com/maps/documentation/geocoding/get-api-key )
      - name: Using classic charts
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.stargazers.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_stargazers: yes

      - name: With worldmap
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.stargazers.worldmap.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_stargazers: yes
            plugin_stargazers_charts: no
            plugin_stargazers_worldmap: yes
            plugin_stargazers_worldmap_token: ${{ secrets.GOOGLE_MAPS_TOKEN }}
            plugin_stargazers_worldmap_sample: 200

      - name: Featured star list languages
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.starlists.languages.svg
            token: NOT_NEEDED
            base: ""
            plugin_starlists: yes
            plugin_starlists_languages: yes
            plugin_starlists_limit_languages: 8
            plugin_starlists_limit_repositories: 0
            plugin_starlists_only: Awesome

      - name: Recently starred
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.stars.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_stars: yes
            plugin_stars_limit: 3

      - name: Labels
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.topics.svg
            token: NOT_NEEDED
            base: ""
            plugin_topics: yes
            plugin_topics_limit: 12

      - name: Repositories traffic
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.traffic.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: repositories
            plugin_traffic: yes

      - name: MBTI Personality profile
        if: ${{ success() || failure() }}
        uses: lowlighter/metrics@latest
        with:
            filename: metrics.plugin.16personalities.svg
            token: ${{ METRICS_TOKEN_WITH_SCOPES }}
            base: ""
            plugin_16personalities: yes
            plugin_16personalities_url: ${{ secrets.SIXTEEN_PERSONALITIES_URL }}
            plugin_16personalities_sections: profile, personality, traits
            plugin_16personalities_scores: no
            output_action: pull-request-merge
